library(tidyverse)

Monthly_Delay_Summa <- data.frame()
Day_of_Wk_Delay_Summa <- data.frame()

for(i in 1987:2008){
  year = i
  FILE = paste('~/Documents/USYD/COMP5048/Group_Project/', i, ".csv", sep = '')
  Dt <- read_csv(file = FILE)
  
  # Monthly Summarise
  new_Monthly_Delay_Summa <- Flight_Data %>% 
  group_by(Month) %>% 
  summarise(Count = n(), 
            Avg_Dep_Delay = mean(DepDelay, na.rm = TRUE),
            Avg_Arr_Delay = mean(ArrDelay, na.rm = TRUE),
            Total_Num_Cancelled = sum(Cancelled == '1', na.rm = TRUE),
            Cancelled_Reason_Carrier = sum(CancellationCode == 'A',na.rm = TRUE),
            Cancelled_Reason_Weather = sum(CancellationCode == 'B',na.rm = TRUE),
            Cancelled_Reason_Security = sum(CancellationCode == 'D',na.rm = TRUE),
            Cancelled_Reason_NAS = sum(CancellationCode == 'C',na.rm = TRUE),
            Total_Carrier_Delay_Mins = sum(CarrierDelay, na.rm = TRUE),
            Total_Weather_Delay_Mins = sum(WeatherDelay, na.rm = TRUE),
            Total_NAS_Delay_Mins = sum(NASDelay, na.rm = TRUE),
            Total_Security_Delay_Mins = sum(SecurityDelay, na.rm = TRUE),
            Total_LateAircraft_Delay_Mins = sum(LateAircraftDelay, na.rm = TRUE)) %>% 
    mutate(Year = year)
  
  # Day of Week Summarise
  new_Day_of_Wk_Delay_Summa <- Flight_Data %>% 
  group_by(DayOfWeek) %>% 
  summarise(Count = n(),
            Avg_Dep_Delay = mean(DepDelay, na.rm = TRUE),
            Avg_Delay = mean(ArrDelay, na.rm = TRUE),
            Total_Num_Cancelled = sum(Cancelled == '1', na.rm = TRUE),
            Cancelled_Reason_Carrier = sum(CancellationCode == 'A',na.rm = TRUE),
            Cancelled_Reason_Weather = sum(CancellationCode == 'B',na.rm = TRUE),
            Cancelled_Reason_Security = sum(CancellationCode == 'D',na.rm = TRUE),
            Cancelled_Reason_NAS = sum(CancellationCode == 'C',na.rm = TRUE),
            Total_Carrier_Delay_Mins = sum(CarrierDelay, na.rm = TRUE),
            Total_Weather_Delay_Mins = sum(WeatherDelay, na.rm = TRUE),
            Total_NAS_Delay_Mins = sum(NASDelay, na.rm = TRUE),
            Total_Security_Delay_Mins = sum(SecurityDelay, na.rm = TRUE),
            Total_LateAircraft_Delay_Mins = sum(LateAircraftDelay, na.rm = TRUE)) %>% 
  mutate(DayOfWeek = c("Mon","Tue","Wed","Thur","Fri","Sat","Sun"))
  
  Monthly_Delay_Summa <- rbind(Monthly_Delay_Summa, new_Monthly_Delay_Summa)
  Day_of_Wk_Delay_Summa <- rbind(Day_of_Wk_Delay_Summa, new_Day_of_Wk_Delay_Summa)

  # Remove the data and clear the memory
  rm(Dt)
}
